%%% Configurations/07-Chapters.sty %%%
%%% Chapter and Section Formatting for Veritas Template
%%%
%%% FIRST PRINCIPLES BASIS:
%%% This module implements chapter design derived from:
%%%
%%% 1. Bringhurst, R. (2012). The Elements of Typographic Style.
%%%    - Chapter openings as "doorways" to content (§6.4)
%%%    - White space before chapter titles for pause and transition
%%%
%%% 2. Tschichold, J. (1991). The Form of the Book.
%%%    - Large chapter numbers as visual anchors
%%%    - Consistent vertical rhythm across pages
%%%
%%% 3. Müller-Brockmann, J. (1981). Grid Systems in Graphic Design.
%%%    - Modular scale for typographic hierarchy
%%%    - Consistent spacing based on leading multiples
%%%
%%% COMPLIANCE: Standard.md
%%% - LOC-1 Rule 1: LaTeX2e conformant (no deprecated syntax)
%%% - LOC-4 Rule 14: Semantic environments for structural elements

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{07-Chapters}[2025/12/12 v1.0.0 Veritas Chapter Formatting]

%%% NOTE: burgundy color defined in 01-Colors.sty %%%
%%% Do not redefine here (LOC-4: avoid duplication) %%%

%%% Classic Chapter Style %%%
% Traditional right-aligned large numeral with title below
\ifthenelse{\equal{\ChapterOption}{classic}}{
    \titleformat{\chapter}[display]%
    {\raggedleft\huge}%
    {\raggedleft\minionsubheadfont\fontsize{96}{10}\bfseries%
        {\color{burgundy}\addfontfeature{LetterSpace=4}\thechapter}}%
    {15pt}%
    {\hspace{2cm}\miniondisplayfont\fontsize{36}{42}\selectfont\addfontfeature{LetterSpace=2}}%
    
    \titlespacing*{\chapter}{0pt}{-30pt}{40pt}
}{}

%%% Fancy Chapter Style %%%
% Modern design with vertical rule accent
\ifthenelse{\equal{\ChapterOption}{fancy}}{
    \titleformat{\chapter}[display]
    {\flushright\normalsize\huge\color{black}}%
    {\flushright\normalsize%
        {\minionsubheadfont\fontsize{32}{34}\selectfont\bfseries%
        \textcolor{burgundy!60}{\rule[-4pt]{2pt}{40pt}}\hspace{1em}%
        \raisebox{8pt}{\color{burgundy}\addfontfeature{LetterSpace=6}\thechapter}}}%
    {18pt}%
    {\miniondisplayfont\addfontfeature{LetterSpace=12}\fontsize{28}{34}\selectfont}%
    
    \titlespacing*{\chapter}{0pt}{-30pt}{45pt}
}{}

%%% Modern Chapter Style %%%
% Bold minimalist with uppercase title
\ifthenelse{\equal{\ChapterOption}{modern}}{
    \titleformat{\chapter}[display]
    {\normalsize\huge\color{black}}%
    {\minionsubheadfont\flushright\fontsize{92}{10}\bfseries%
        {\color{burgundy}\addfontfeature{LetterSpace=0}%
        \raisebox{10pt}{\thechapter}}%
    }{20pt}%
    {\miniondisplayfont\addfontfeature{LetterSpace=16}\fontsize{26}{32}\selectfont%
        \MakeUppercase}%
    
    \titlespacing*{\chapter}{0pt}{-30pt}{50pt}
}{}

%%% Part Formatting %%%
% Elegant full-page design for major divisions
\makeatletter
\renewcommand\part{%
  \if@openright
    \cleardoublepage
  \else
    \clearpage
  \fi
  \thispagestyle{empty}%
  \if@twocolumn
    \onecolumn
    \@tempswatrue
  \else
    \@tempswafalse
  \fi
  \null\vfil
  \secdef\@part\@spart}

\def\@part[#1]#2{%
    \ifnum \c@secnumdepth >-2\relax
      \refstepcounter{part}%
      \addcontentsline{toc}{part}{\thepart\hspace{1em}#1}%
    \else
      \addcontentsline{toc}{part}{#1}%
    \fi
    \markboth{}{}%
    {\centering
     \interlinepenalty \@M
     \normalfont
     \miniondisplayfont\fontsize{14}{18}\selectfont\addfontfeature{LetterSpace=12}%
     \MakeUppercase{\partname\nobreakspace\thepart}%
     \par
     \vskip 2.5em
     \miniondisplayfont\fontsize{32}{40}\selectfont\addfontfeature{LetterSpace=3}%
     #2\par}%
    \@endpart}

\def\@spart#1{%
    {\centering
     \interlinepenalty \@M
     \normalfont
     \miniondisplayfont\fontsize{32}{40}\selectfont\addfontfeature{LetterSpace=3}%
     #1\par}%
    \@endpart}

\def\@endpart{\vfil\newpage
              \if@twoside
               \if@openright
                \null
                \thispagestyle{empty}%
                \newpage
               \fi
              \fi
              \if@tempswa
                \twocolumn
              \fi}
\makeatother

%%% Section Formatting %%%
% Body text size (11pt/13.2pt) for hierarchical consistency
% Rationale: Bringhurst §4.2 — sections subordinate to chapters
\titleformat{\section}
    {\minionfont\fontsize{11pt}{13.2pt}\selectfont\bfseries}
    {\textcolor{burgundy}{\thesection}}
    {1em}
    {}

\titlespacing*{\section}{0pt}{13.2pt}{0pt}

%%% Subsection Formatting %%%
\titleformat{\subsection}
    {\minionfont\fontsize{11pt}{13.2pt}\selectfont\bfseries}
    {\textcolor{burgundy}{\thesubsection}}
    {1em}
    {}

\titlespacing*{\subsection}{0pt}{13.2pt}{0pt}

%%% Subsubsection Formatting %%%
% Run-in style for tertiary divisions
\titleformat{\subsubsection}[runin]
    {\minionfont\fontsize{11pt}{13.2pt}\selectfont\itshape}
    {\textcolor{burgundy!80}{\thesubsubsection}}
    {0.8em}
    {}
    [.]

\titlespacing*{\subsubsection}{0pt}{6.6pt}{0.5em}